<!DOCTYPE html>
<html lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html" charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0"/>
  <title>FF Personal Trainer</title>

  <!-- CSS  -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link href="css/materialize.css" type="text/css" rel="stylesheet" media="screen,projection"/>
  <link href="css/style.css" type="text/css" rel="stylesheet" media="screen,projection"/>
  <link rel="stylesheet" href="tag/tagselector.css">
  <style>
  #popupBackground { 
    opacity: 0.85;
    background-color:#FFFFFF;
    position: relative;
    margin-top: 50px;
    margin-bottom: 50px;
    margin-right: auto;
    margin-left: auto;
    padding-top: 50px;
    padding-bottom: 50px;
    border-radius: 30px 30px 30px 30px;
  }
  .topcorner {
    color:#000000;
    position: absolute;
    top: 30px;
    right: 30px;
  }
  .img {
    display: block;
    margin-left: auto;
    margin-right: auto;
    width: 50%;
}
  </style>

<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-9673857434699100",
    enable_page_level_ads: true
  });
</script>

</head>

<body>

  <div class="container">
    <div class="section">

      <!--   Icon Section   -->
      <div class="row">
        <div class="col s12 m4">
          <div class="row center" id="fieldForm">
            <form action="https://">
              <!-- <h5>title</h5> -->              
              <select id="field1" multiple>
                <option value="1">男</option>
                <option value="2">女</option>
              </select>
              <!-- <h5>title</h5> -->
              <hr color="#eeeeee" size="1">
              <div class="field2">     
              <select id="field2" multiple>                 
              </select>
              </div>
              <!-- <h5>title</h5> -->
              <hr color="#eeeeee" size="1">
              <div class="field3">
                <select id="field3" multiple>                
                </select>
              </div>
            </form>
          </div>
        </div>

        <div class="col s12 m8">
          <div class="icon-block" id="searchResult">            
            <div class="content" id="searchResult1">
              <div class="row center" style="height: 150px; width: 100%;" id="loading">
                  <div class="row center" style="height: 40%; width: 100%;">                    
                  </div>
                  <div class="preloader-wrapper active">
                      <div class="spinner-layer spinner-blue">
                          <div class="circle-clipper left">
                            <div class="circle"></div>
                          </div><div class="gap-patch">
                            <div class="circle"></div>
                          </div><div class="circle-clipper right">
                            <div class="circle"></div>
                          </div>
                        </div>
                  
                        <div class="spinner-layer spinner-red">
                          <div class="circle-clipper left">
                            <div class="circle"></div>
                          </div><div class="gap-patch">
                            <div class="circle"></div>
                          </div><div class="circle-clipper right">
                            <div class="circle"></div>
                          </div>
                        </div>
                  
                        <div class="spinner-layer spinner-yellow">
                          <div class="circle-clipper left">
                            <div class="circle"></div>
                          </div><div class="gap-patch">
                            <div class="circle"></div>
                          </div><div class="circle-clipper right">
                            <div class="circle"></div>
                          </div>
                        </div>
                  
                        <div class="spinner-layer spinner-green">
                          <div class="circle-clipper left">
                            <div class="circle"></div>
                          </div><div class="gap-patch">
                            <div class="circle"></div>
                          </div><div class="circle-clipper right">
                            <div class="circle"></div>
                          </div>
                        </div>
                  </div>                
              </div>
            </div>            
          </div>
        </div>
      </div>

    </div>
    <br><br>
  </div>

  <script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
  <script src="js/materialize.js"></script>
  <script src="js/init.js"></script>

  <script src="tag/tagselector.js"></script>
  
  <script>
    var config1 = {
      onSelect: function(value, text) {  
           
        tags.push(value);
        // alert(`tags: ${tags.join()}`);
        submitForm();
      },
      onDeselect: function(value, text) {
        
        idx = tags.indexOf(value);
        if (idx != null) {
          tags.splice(idx,1);
        }
        submitForm();
      }
    };
    var field1 = new TagSelector(document.getElementById('field1'), config1);

    var config2 = {
      max: 1,
      onSelect: function(value, text) {
        onClickAreaBtn(value)
      },
      onDeselect: function(value, text) {
        
      }
    };
    function onClickAreaBtn(value) {
        var qID = genQueryID();
        queryStoreName(value,qID);
        switch(value) {
        case 'F001':
          store = 'KH01';
          break;
        case 'F002':
          store = 'CY01';
          break;
        case 'F003':
          store = 'TC01';
          break;
        case 'F004':
          store = 'HC01';
          break;
        case 'F005':
          store = 'NT01';
          break;
        default:
          break;
        }                
        submitForm(qID);
    }
    var field2 = new TagSelector(document.getElementById('field2'), config2);

    var config3 = {
      max: 1,
      onSelect: function(value, text) {  
        store = value
        submitForm();
      },
      onDeselect: function(value, text) {
        
      }
    };
    new TagSelector(document.getElementById('field3'));

    var kk = "SlnNbFTFZFkdnydqzr71OmVCmyBT1k0ZdvdfnRGE";
    function aa(t) {
      return kk;
    }
    
  </script>

  <!-- <script src="https://script.google.com/macros/s/AKfycbxrcTwFyt6WoeOfzI3Kfj8ywA7azE8lFWuKdbOh4Ysal9NiEOHk/exec"></script> -->
  
  <script>
    
    var loadingHTML = document.getElementById('searchResult1').innerHTML;
    document.getElementById('searchResult1').innerHTML = "";

    var queryID = "a";
    var tags = [];
    var store;

    function post(path, params, method) {
    method = method || "post"; // Set method to post by default if not specified.

    // The rest of this code assumes you are not using a library.
    // It can be made less wordy if you use one.
    var form = document.createElement("form");
    form.setAttribute("method", method);
    form.setAttribute("action", path);

    for(var key in params) {
        if(params.hasOwnProperty(key)) {
            var hiddenField = document.createElement("input");
            hiddenField.setAttribute("type", "hidden");
            hiddenField.setAttribute("name", key);
            hiddenField.setAttribute("value", params[key]);
            form.appendChild(hiddenField);
        }
    }

    document.body.appendChild(form);
    form.submit();
  }
 
  // function callback(e) {
  //   alert(e)
  //   var json = JSON.stringify(e)
  //   alert(json)
  //   var obj = JSON.parse(json)
  //   alert(obj)
  // }
  function submitForm(qID) {
    if (qID) {
      queryID = qID;
    } else {
      queryID = genQueryID();
    }
    $('#searchResult').find('.content').html(loadingHTML);    
    // alert(loadingHTML);
    var dt = new Date();
    var time = dt.getHours() + ":" + dt.getMinutes() + ":" + dt.getSeconds();

    var paraCondition = "0"
    if (tags.length == 1) {
      paraCondition = tags[0]
    }
    //alert(paraCondition);
    $.ajax({
         type: "get",
         async: true,
         data: {t: "trainer", condition: paraCondition, storename: store, queryID: queryID},
         url: "https://script.google.com/macros/s/AKfycbxQEHHUmM4sAigFbK-GRSQMaS0KCGqPsN3hRSlne9kr2LZpQyw/exec",
         dataType: "jsonp",
         success: function(res){
         },
         error: function(error){
          //  alert(error)
         }
     });
    //  $('#fieldForm').find('.field2').html("dddd");
  }

  function queryStoreName(areaNo,qID) { 
    if (qID) {
      queryID = qID;
    } else {
      queryID = genQueryID();
    }
    $('#fieldForm').find('.field3').html(loadingHTML);    
    // alert(loadingHTML);
    var dt = new Date();
    var time = dt.getHours() + ":" + dt.getMinutes() + ":" + dt.getSeconds();

    var paraCondition = "0"
    if (tags.length == 1) {
      paraCondition = tags[0]
    }
    //alert(paraCondition);
    $.ajax({
         type: "get",
         async: true,
         data: {t: "storename", area: areaNo, queryID: queryID},
         url: "https://script.google.com/macros/s/AKfycbxQEHHUmM4sAigFbK-GRSQMaS0KCGqPsN3hRSlne9kr2LZpQyw/exec",
         dataType: "jsonp",
         success: function(res){
         },
         error: function(error){
          //  alert(error)
         }
     });
    //  $('#fieldForm').find('.field2').html("dddd");
  }
  
  function genQueryID() {
    return Math.floor(new Date().getTime() / 1000) + Math.floor((Math.random() * 10) + 1);
  } 
  
  </script>

    <script src="https://script.google.com/macros/s/AKfycbxQEHHUmM4sAigFbK-GRSQMaS0KCGqPsN3hRSlne9kr2LZpQyw/exec?t=areaname&queryID=a"></script>

    <div id="my_popup">
      <div class="content">
      </div>
      <!-- <a href='#' onclick='hidePopup();'><i class='material-icons topcorner'>close</i></a> -->
      <!-- <button class="my_popup_close topcorner">Close</button>   -->
    </div>
    <script src="https://cdn.rawgit.com/vast-engineering/jquery-popup-overlay/1.7.13/jquery.popupoverlay.js"></script>
    <script>
      $(document).ready(function() {

        // Initialize the plugin
        $('#my_popup').popup();

      });
      function hidePopup() {
        $('#my_popup').popup('hide');
      }
      function showPopup(trainerNo,store) {
        $('#my_popup').popup('show');
        $('#my_popup').find('.content').html(loadingHTML);
        $.ajax({
         type: "get",
         async: true,
         data: {t: "trainerDetail", trainerNo: trainerNo, storename: store, queryID: queryID},
         url: "https://script.google.com/macros/s/AKfycbxQEHHUmM4sAigFbK-GRSQMaS0KCGqPsN3hRSlne9kr2LZpQyw/exec",
         dataType: "jsonp",
         success: function(res){
         },
         error: function(error){
          //  alert(error)
         }
     });
      }
    </script>
  </body>
</html>
